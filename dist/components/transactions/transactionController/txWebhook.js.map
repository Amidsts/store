{"version":3,"file":"txWebhook.js","sourceRoot":"src/","sources":["components/transactions/transactionController/txWebhook.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AACA,8DAAiC;AAEjC,sDAA0D;AAE1D,+DAAyC;AACzC,6EAA2C;AAE3C,MAAM,EAAE,cAAc,EAAE,GAAG,iBAAS,CAAC;AAErC,SAAe,gBAAgB,CAAC,GAAa,EAAE,GAAa;;QAC1D,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,qBAAM;iBAChB,UAAU,CAAC,QAAQ,EAAE,cAAc,CAAC;iBACpC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;iBAChC,MAAM,CAAC,KAAK,CAAC,CAAC;YAEjB,IAAI,IAAI,KAAK,GAAG,CAAC,OAAO,CAAC,sBAAsB,CAAC;gBAC9C,OAAO,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAE7B,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YACpB,MAAM,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;YAE1B,MAAM,2BAAO,CAAC,gBAAgB,CAC5B,EAAE,gBAAgB,EAAE,IAAI,CAAC,SAAS,EAAE,EACpC,EAAE,IAAI,EAAE,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE,EAClC,EAAE,GAAG,EAAE,IAAI,EAAE,CACd,CAAC;YAEF,OAAO;QACT,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAA,0BAAe,EAAC;gBACd,GAAG;gBACH,GAAG;gBACH,OAAO,EAAE,2BAA2B,GAAG,CAAC,OAAO,EAAE;gBACjD,MAAM,EAAE,GAAG;aACZ,CAAC,CAAC;QACL,CAAC;IACH,CAAC;CAAA;AAED,kBAAe,gBAAgB,CAAC","sourcesContent":["import { Response } from \"express\";\nimport crypto from \"node:crypto\";\n\nimport { responseHandler } from \"../../../utils/response\";\nimport { IRequest } from \"../../../utils/types\";\nimport appConfig from \"../../../configs\";\nimport TxModel from \"../transaction.model\";\n\nconst { paystackSecret } = appConfig;\n\nasync function txWebhookHandler(req: IRequest, res: Response) {\n  try {\n    const hash = crypto\n      .createHmac(\"sha512\", paystackSecret)\n      .update(JSON.stringify(req.body))\n      .digest(\"hex\");\n\n    if (hash !== req.headers[\"x-paystack-signature\"])\n      return res.sendStatus(400);\n\n    res.sendStatus(200);\n    const { data } = req.body;\n\n    await TxModel.findOneAndUpdate(\n      { paymentReference: data.reference },\n      { $set: { status: \"successful\" } },\n      { new: true }\n    );\n\n    return;\n  } catch (err) {\n    responseHandler({\n      res,\n      err,\n      message: `Internal Server Error:  ${err.message}`,\n      status: 500,\n    });\n  }\n}\n\nexport default txWebhookHandler;\n"]}